{% extends 'core/base.html' %}
{% block content %}{% csrf_token %}
  <button type="button" class="btn btn-lg btn-block btn-outline-primary" id="btnReclamar">Reclamar POAP</button>
{% endblock %}
{% block script %}
  <script>
      function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
              const cookies = document.cookie.split(';');
              for (let i = 0; i < cookies.length; i++) {
                  const cookie = cookies[i].trim();
                  // Does this cookie string begin with the name we want?
                  if (cookie.substring(0, name.length + 1) === (name + '=')) {
                      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                      break;
                  }
              }
          }
          return cookieValue;
      }

      const csrftoken = getCookie('csrftoken');

      $('#btnReclamar').on('click', function () {
          return fetch('{% url 'home' %}', {
              method: 'post',
              body: JSON.stringify({
                  'value': "hola",
                  'type': "Hola22",
              }),
              headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': csrftoken
              }
          }).then(response => response.json())
              .then(data => {
                  console.log(data, typeof (data));

                  window.location.href = data[Object.keys(data)[0]];
              })
              .catch(console.error);
      });

  </script>
{% endblock %}